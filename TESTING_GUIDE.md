# 推播功能測試指南

## 測試環境準備

1. **確保已登入**：App 會自動匿名登入，或手動登入
2. **確保有推播中的商品**：在「泡泡庫」中至少有一個商品開啟推播功能

## 測試流程

### 1. 測試推播收件匣功能

#### 步驟：
1. 進入「推播中心」（從「我的」頁面進入）
2. 點擊右上角「收件匣」圖示（📥）
3. 查看「推播收件匣」頁面

#### 預期結果：
- 顯示所有「已到時間但未開啟且未略過」的推播
- 每個項目顯示：標題、時間、內容預覽
- 有「補看」和「已讀」按鈕

#### 測試「補看」功能：
1. 點擊某個推播的「補看」按鈕
2. 應該跳轉到對應商品的內容頁面
3. 頁面應該自動滾動到該推播對應的內容卡片（有淡藍色邊框）
4. 該推播應該自動標記為已讀，從收件匣中消失

#### 測試「已讀」功能：
1. 點擊某個推播的「已讀」按鈕
2. 該推播應該從列表中消失
3. 不會跳轉到任何頁面

#### 測試「清空收件匣」：
1. 點擊右上角「清空」圖示（🗑️）
2. 所有推播應該被清除
3. 顯示「已清空收件匣」提示

---

### 2. 測試 Timeline（未來 3 天時間表）功能

#### 步驟：
1. 進入「推播中心」
2. 點擊右上角「時間表」圖示（📊）
3. 查看「未來 3 天時間表」頁面

#### 預期結果：
- 顯示未來 3 天內所有已排程的推播
- 每個項目顯示：時間、商品名稱、內容預覽
- 有「補看」和「跳過下一則」按鈕

#### 測試「補看」功能：
1. 點擊某個推播的「補看」按鈕
2. 應該跳轉到對應商品的內容頁面
3. 頁面應該自動滾動到該推播對應的內容卡片

#### 測試「跳過下一則」功能：
1. 點擊某個推播的「跳過下一則」按鈕
2. 顯示「已跳過下一則並重排」提示
3. 點擊右上角「重排」按鈕（🔄）
4. 該推播應該從 Timeline 中消失（因為被跳過了）
5. 重排後，該推播不會再出現（一次性跳過）

#### 測試「重排未來 3 天」：
1. 點擊右上角「重排」圖示（🔄）
2. 顯示「已重排未來 3 天推播」提示
3. Timeline 列表應該更新
4. 被標記為「跳過下一則」的推播應該被過濾掉

---

### 3. 測試點擊推播通知功能

#### 步驟：
1. 等待推播通知出現（或手動觸發測試通知）
2. 點擊通知

#### 預期結果：
- App 應該自動打開（如果是冷啟動）
- 自動跳轉到對應商品的內容頁面
- 頁面應該自動滾動到該推播對應的內容卡片
- 該推播應該自動標記為已讀，從收件匣中消失

#### 測試冷啟動：
1. 完全關閉 App
2. 點擊一個推播通知
3. App 應該啟動並自動跳轉到對應內容

---

### 4. 測試推播排程功能

#### 步驟：
1. 進入「推播中心」
2. 點擊右上角「重排」圖示（🔄）

#### 預期結果：
- 顯示「已重排未來 3 天推播」提示
- Timeline 應該更新
- 收件匣應該更新（未來 3 天的推播會寫入收件匣）

---

### 5. 測試「跳過下一則」的持久性

#### 步驟：
1. 在 Timeline 中點擊某個推播的「跳過下一則」
2. 點擊「重排」按鈕
3. 該推播應該被跳過
4. 再次點擊「重排」
5. 該推播應該重新出現（因為是一次性跳過，已清除）

#### 預期結果：
- 第一次重排：被跳過的推播消失
- 第二次重排：被跳過的推播重新出現（因為 skip 已被清除）

---

## 常見問題排查

### 問題：收件匣是空的
- **原因**：可能沒有錯過的推播，或所有推播都已標記為已讀/已略過
- **解決**：等待推播時間到，或手動重排推播

### 問題：Timeline 是空的
- **原因**：可能沒有推播中的商品，或沒有排程
- **解決**：確保至少有一個商品開啟推播功能，然後點擊「重排」

### 問題：點擊通知沒有跳轉
- **原因**：可能 `rootNavKey` 沒有正確設置
- **解決**：檢查 `main.dart` 中 `MaterialApp` 是否有 `navigatorKey: rootNavKey`

### 問題：補看時沒有自動滾動
- **原因**：可能 `initialContentItemId` 沒有正確傳遞
- **解決**：檢查 `ProductLibraryPage` 的 `_tryJumpToTarget()` 方法是否正確執行

---

## 測試檢查清單

- [ ] 收件匣可以正常顯示錯過的推播
- [ ] 補看功能可以跳轉並自動滾動到對應卡片
- [ ] 已讀功能可以標記推播為已讀
- [ ] 清空收件匣功能正常
- [ ] Timeline 可以顯示未來 3 天的推播
- [ ] 跳過下一則功能可以跳過推播
- [ ] 重排功能可以更新 Timeline
- [ ] 點擊通知可以自動跳轉（熱啟動）
- [ ] 點擊通知可以自動跳轉（冷啟動）
- [ ] 跳過下一則是一次性的（重排後清除）

---

## 測試數據準備

### 快速測試方法：
1. 在「推播中心」點擊「重排」按鈕，生成未來 3 天的推播
2. 在 Timeline 中查看排程
3. 手動將系統時間調到某個推播時間之後，該推播應該出現在收件匣中

### 模擬錯過推播：
1. 在 Timeline 中找到一個即將到來的推播
2. 將系統時間調到該推播時間之後
3. 該推播應該出現在收件匣中

---

## 注意事項

1. **時間同步**：測試時注意系統時間，推播是基於實際時間排程的
2. **一次性跳過**：跳過下一則是「一次性」的，重排後會清除，不會永久跳過
3. **收件匣範圍**：收件匣只顯示「已到時間但未開啟且未略過」的推播
4. **Timeline 範圍**：Timeline 顯示未來 3 天的推播（與重排天數一致）
